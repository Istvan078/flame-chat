<div class="row">
  <div class="col-12">
    <form
      class="d-grid justify-content-center"
      (ngSubmit)="saveProfile()"
      #f="ngForm"
    >
      <mat-form-field>
        <mat-label for="email">Email</mat-label>
        <input
          matInput
          [(ngModel)]="userProf.email"
          type="email"
          name="email"
          email
          required
          #emaill="ngModel"
        />
      </mat-form-field>

      <mat-form-field>
        <mat-label for="displayName">Felhasználónév</mat-label>
        <input
          matInput
          [(ngModel)]="userProf.displayName"
          type="text"
          name="displayName"
          required
        />
      </mat-form-field>

      <mat-form-field>
        <mat-label for="birthDate">Születési idő</mat-label>
        <input
          matInput
          [(ngModel)]="userProf['birthDate']"
          type="date"
          name="birthDate"
          required
        />
      </mat-form-field>

      <div *ngFor="let gender of genders">
        <label>
          <input
            [(ngModel)]="userProf['gender']"
            ngModel
            [value]="gender"
            type="radio"
            name="gender"
            id="gender"
            required
          />
          {{ gender }}
        </label>
      </div>

      <div class="mt-2">
        <h2 class="text-center">
          <label id="profilePicture" class="form-label" for="profilePicture"
            >Profilkép kiválasztása:</label
          >
        </h2>
        <input
          id="profilePicture"
          (change)="selectFile($event)"
          class="form-control"
          [(ngModel)]="profilePhoto"
          type="file"
          name="profilePicture"
          [required]="!userProf.profilePicture"
        />
        <button [disabled]="!profilePhoto"
          (click)="
            userProf.profilePicture ? changeProfilePic() : addProfilePic()
          "
          type="button"
          class="btn btn-primary mt-1"
        >
          Profilkép Feltöltése
        </button>
      </div>

      <div
        *ngIf="profilePhoto"
        class="progress mt-2 progressC"
        style="height: 50px; width: 100%"
      >
        <div
          [style]="{ width: percent + '%' }"
          class="progress-bar progressC"
          role="progressbar"
          [attr.aria-valuenow]="percent"
          [attr.aria-valuemin]="percent"
          aria-valuemax="100"
        >
          <h4 class="pt-2">{{ percent }}%</h4>
        </div>
      </div>

      <div class="d-grid justify-content-center">
        <div
          *ngIf="percent === 0 || pictures; else newPic"
          class="profilePicContainer"
        >
          <img
            [src]="userProf.profilePicture"
            [alt]="userProf.profilePicture"
          />
        </div>
      </div>

      <ng-template #newPic>
        <div class="d-grid justify-content-center">
          <div class="profilePicContainer">
            <img [src]="profilePhotoUrl" alt="Profilkep" />
          </div>
        </div>
      </ng-template>

      <div *ngIf="userBirthDate" class="mb-2">
        <h2 class="text-center">
          <label id="profilePicture" class="form-label" for="profilePicture"
            >Képek feltöltése</label
          >
        </h2>
        <input
          name="pictures"
          class="form-control"
          (change)="selectFiles($event)"
          type="file"
          multiple
        />
        <button
        [disabled]="!pictures"
          (click)="addPictures()"
          type="button"
          class="btn btn-primary mt-1"
        >
          Képek Feltöltése
        </button>
      </div>

      <div
        *ngIf="pictures"
        class="progress my-2 progressC"
        style="height: 50px; width: 100%"
      >
        <div
          [style]="{ width: percent + '%' }"
          class="progress-bar progressC"
          role="progressbar"
          [attr.aria-valuenow]="percent"
          [attr.aria-valuemin]="percent"
          aria-valuemax="100"
        >
          <h4 class="pt-2">{{ percent }}%</h4>
        </div>
      </div>

      <div class="d-flex justify-content-start flex-wrap">
        <div *ngFor="let pic of userPictures" class="my-2 mx-2">
          <a [href]="pic.url">
            <img
            data-bs-toggle="carousel"
            data-bs-target="#picturesCarousel"
              [src]="pic.url"
              alt=""
              width="50px"
              height="50px"
              class="rounded"
            />
          </a>
        </div>
      </div>

          <div *ngIf="userPictures.length > 0" [attr.data-bs-interval]="false" id="picturesCarousel" class="carousel slide" data-bs-ride="carousel">
            <div  class="carousel-indicators">
              <button *ngFor="let pic of userPictures; let i = index" type="button" [attr.data-bs-target]="'#picturesCarousel'" [attr.data-bs-slide-to]="i" [class.active]="i === 0" attr.aria-label="Slide {{i + 1}}"></button>
            </div>
            <div class="carousel-inner">
              <div *ngFor="let pic of userPictures; let i = index" class="carousel-item" [ngClass]="{'active': i === 0}">
                
                  <mat-icon (click)="deletePicture(pic)" class="deletePicture">delete_forever</mat-icon>
                
                <img  [src]="pic.url" class="d-block w-100" alt="...">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#picturesCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#picturesCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>



      <button [disabled]="!f.valid" class="mt-2" color="accent" mat-raised-button type="submit">
        Adatok mentése
      </button>
      <button [disabled]="!userBirthDate" routerLink="/chat" class="greenButton mt-1" mat-raised-button type="button">
        Vissza
      </button>
    </form>
  </div>
</div>
