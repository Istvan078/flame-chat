<!-- HOME PAGE BLOCK (MAIN CONTAINER) -->
<div class="home-page">
  <!-- Home page bar / Header -->
  <mat-toolbar class="appbar">
    <span class="title">
      <mat-icon class="fire">local_fire_department</mat-icon>
      Flame Chat
    </span>
    <span class="spacer"></span>

    <mat-slide-toggle
      #slideToggle
      (click)="
        updateUserNotifications({ checked: !subscribedForNotifications })
      "
      [checked]="subscribedForNotifications"
    ></mat-slide-toggle>
    <button mat-icon-button aria-label="Értesítések">
      <mat-icon>{{
        slideToggle.checked ? 'notifications_active' : 'notifications_none'
      }}</mat-icon>
    </button>

    <button mat-icon-button (click)="openProfileOptions()" aria-label="Profil">
      <!-- <mat-icon class="account-settings">account_circle</mat-icon> -->
      <img
        [src]="userProfile.profilePicture"
        alt="Profilkép"
        class="rounded-circle"
        width="50px"
        height="50px"
      />
    </button>
  </mat-toolbar>

  <!-- SEARCH SECTION -->
  <section class="search-section">
    <button
      (click)="searchField.hidden = !searchField.hidden"
      class="btn search-section__search-btn"
    >
      <mat-icon class="u-align-middle">search</mat-icon>
      {{ searchField.hidden ? 'Search By Name' : '' }}
    </button>
    <input
      hidden="true"
      class="search-section__search-field"
      placeholder="{{ 'mainPage.searchByName' | translate }}"
      #searchField
      type="text"
      [(ngModel)]="userSearched"
      (keyup)="searchUser()"
    />
  </section>

  <!-- SEARCH RESULTS BLOCK -->
  <section class="search-results u-flex">
    @for(user of userSearchedProfiles; track $index; let i = $index){
    <div
      *ngIf="user.uid !== 'NR8BsiJ2DtUy32bGgVnEijzBZ9F2'"
      class="search-results__box u-grid"
    >
      <!-- BACK ARROW -->
      <!-- @if(i===0) {
      <mat-icon>arrow_back_ios</mat-icon>
      } -->
      <button class="btn search-results__btn" (click)="toFriendProfile(user)">
        <img [src]="user.profilePicture" alt="profilkép" class="avatar" />
        <div class="name">{{ user.displayName }}</div>
      </button>
      @for (notFriend of userNotFriends; track $index;) {

      <button
        *ngIf="notFriend.friendId === user.uid"
        class="btn btn-add-friend"
        (click)="signAsAFriend(notFriend)"
      >
        <mat-icon class="u-align-middle">person_add</mat-icon>
        {{ 'user.signAsFriend' | translate }}
      </button>
      }
      <!-- FORWARD ARROW -->
      <!-- @if(i===3) {
      <mat-icon>arrow_forward_ios</mat-icon>

      } -->
    </div>
    } @empty { @for(user of userNotFriends; track $index; let i = $index){
    <div
      *ngIf="user.friendId !== 'NR8BsiJ2DtUy32bGgVnEijzBZ9F2'"
      class="search-results__box u-grid"
    >
      <!-- BACK ARROW -->
      <!-- @if(i===0) {
      <mat-icon>arrow_back_ios</mat-icon>
      } -->

      <button class="btn search-results__btn" (click)="toFriendProfile(user)">
        <img [src]="user.profilePicture" alt="profilkép" class="avatar" />
        <div class="name">{{ user.displayName }}</div>
      </button>
      @for (notFriend of userNotFriends; track $index;) {

      <button
        *ngIf="notFriend.friendId === user.friendId"
        class="btn btn-add-friend"
        (click)="signAsAFriend(notFriend)"
      >
        <mat-icon class="u-align-middle">person_add</mat-icon>
        {{ 'user.signAsFriend' | translate }}
      </button>
      }
      <!-- FORWARD ARROW -->
      <!-- @if(i===3) {
      <mat-icon>arrow_forward_ios</mat-icon>

      } -->
    </div>
    } }
  </section>
  <!-- SEARCH RESULTS AND SUGGESTED FRIENDS BLOCK END -->

  <!-- FRIEND CONFIRMATION SECTION -->
  @if(notConfirmedMeUsers.length){
  <section class="signed-me-section u-flex">
    @for(user of notConfirmedMeUsers; track $index){
    <div class="signed-me-section__box u-grid">
      <h4 class="friend-name">{{ user.displayName }}</h4>
      <p class="friend-signed-text">Ismerősnek jelölt</p>
      <img
        [src]="user.profilePicture"
        alt="Profilkép"
        class="avatar"
        (click)="toFriendProfile(user.uid)"
      />
      <button (click)="confirmedFriend(user)" class="btn btn-confirm-friend">
        Megerosites</button
      ><button
        (click)="notConfirmFriend(user)"
        class="btn btn-not-confirm-friend"
      >
        Nem ismerem
      </button>
    </div>
    }
  </section>
  }
  <!-- FRIEND CONFIRMATION SECTION END-->

  <!-- Menücsempék / gyors műveletek -->
  <section class="menu-grid">
    <!-- Saját posztok -->
    <button
      class="menu-card"
      routerLink="/my-posts"
      (click)="
        getMyPosts();
        isMyPostsOpen = true;
        isFeedOpen = false;
        isFriendsOpen = false;
        isUserProfileOn = false;
        scrollToContentArea()
      "
    >
      <div class="icon-wrap">
        <img
          [src]="userProfile.profilePicture"
          alt="Profilkép"
          class="mini-avatar"
        />
      </div>
      <div class="text">
        <div class="label">{{ userProfile.displayName || 'Profilom' }}</div>
        <div class="sub">{{ 'mainPage.myFeeds' | translate }}</div>
      </div>
      <mat-icon
        [matBadgeDisabled]="!myPostsNotificationNumber"
        [matBadge]="myPostsNotificationNumber"
        matBadgeColor="primary"
        >article</mat-icon
      >
    </button>

    <!-- Kezdőlap / Feed -->
    <button
      class="menu-card"
      routerLink="/feeds"
      (click)="
        getSharedPosts();
        isFeedOpen = true;
        isMyPostsOpen = false;
        isFriendsOpen = false;
        isUserProfileOn = false;
        scrollToContentArea()
      "
    >
      <div class="icon-wrap">
        <mat-icon>feed</mat-icon>
      </div>
      <div class="text">
        <div class="label">{{ 'mainPage.feeds' | translate }}</div>
        <div class="sub">{{ 'mainPage.publicPosts' | translate }}</div>
      </div>
      <mat-icon
        [matBadgeDisabled]="!postsNotificationNumber"
        [matBadge]="postsNotificationNumber"
        matBadgeColor="primary"
        >notifications</mat-icon
      >
    </button>

    <!-- Üzenetek -->
    <button class="menu-card" routerLink="/message">
      <div class="icon-wrap">
        <mat-icon>chat</mat-icon>
      </div>
      <div class="text">
        <div class="label">{{ 'mainPage.messages' | translate }}</div>
        <div class="sub">{{ 'mainPage.yourConvs' | translate }}</div>
      </div>
      <mat-icon
        [matBadgeDisabled]="!newMessageNumber"
        [matBadge]="newMessageNumber"
        matBadgeColor="primary"
        >mark_chat_unread</mat-icon
      >
    </button>

    <!-- Fényképeim -->
    <button
      class="menu-card"
      (click)="
        toAlbum();
        isMyPostsOpen = false;
        isFeedOpen = false;
        isFriendsOpen = false;
        isUserProfileOn = false
      "
    >
      <div class="icon-wrap">
        <mat-icon>photos</mat-icon>
      </div>
      <div class="text">
        <div class="label">{{ 'mainPage.albums' | translate }}</div>
        <!-- <div class="sub">Albumok és képek</div> -->
      </div>
      <mat-icon>chevron_right</mat-icon>
    </button>

    <!-- Ismerősök -->
    <button
      class="menu-card"
      (click)="
        isFriendsOpen = true;
        isFeedOpen = false;
        isMyPostsOpen = false;
        isUserProfileOn = false;
        scrollToContentArea()
      "
    >
      <div class="icon-wrap">
        <mat-icon>groups</mat-icon>
      </div>
      <div class="text">
        <div class="label">{{ 'mainPage.friends' | translate }}</div>
        <div class="sub">{{ 'mainPage.yourFriends' | translate }}</div>
      </div>
      <mat-icon
        [matBadgeDisabled]="!userFriends?.length"
        [matBadge]="userFriends?.length"
        matBadgeColor="primary"
        >diversity_3</mat-icon
      >
    </button>

    <!-- Profilom -->
    <button
      class="menu-card"
      (click)="
        toUserProfile();
        isUserProfileOn = true;
        isFeedOpen = false;
        isMyPostsOpen = false;
        isFriendsOpen = false
      "
    >
      <div class="icon-wrap">
        <mat-icon>person</mat-icon>
      </div>
      <div class="text">
        <div class="label">{{ 'mainPage.profile' | translate }}</div>
        <div class="sub">{{ 'mainPage.profAndSett' | translate }}</div>
      </div>
      <mat-icon>chevron_right</mat-icon>
    </button>
  </section>

  <!-- Tartalmi szekciók (panelek helyett) -->
  <section class="content scroll-to-content" *ngIf="isMyPostsOpen">
    <app-my-posts></app-my-posts>
  </section>

  <section class="content scroll-to-content" *ngIf="isFeedOpen">
    <app-news [userFriends]="this.userFriends"></app-news>
  </section>

  <section class="content scroll-to-content" *ngIf="isFriendsOpen">
    <div class="friends-grid">
      @for(friend of userFriends; let i = $index; track $index){ @defer(on
      viewport){
      <mat-card class="friend-card">
        <img
          [src]="friend.profilePicture"
          width="56"
          height="56"
          class="avatar"
          alt=""
          (click)="showProfPics(friend)"
        />
        <div class="fname">{{ friend.displayName }}</div>
        <div class="femail">{{ friend.email }}</div>
        <div class="actions">
          <button
            mat-stroked-button
            color="primary"
            (click)="toFriendProfile(friend)"
          >
            <mat-icon>person</mat-icon>
            Profil
          </button>
          <button
            mat-stroked-button
            color="warn"
            (click)="removeFriend(friend)"
          >
            <mat-icon>person_remove</mat-icon>
            Törlés
          </button>
        </div>
      </mat-card>
      } @placeholder{
      <p>Ismerosok listaja toltodik...</p>
      } }
    </div>
  </section>

  <section class="content" *ngIf="isUserProfileOn && userProfile.uid">
    <app-user-profile></app-user-profile>
  </section>
</div>
