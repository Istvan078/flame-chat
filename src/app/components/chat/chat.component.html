<h1 class="text-center">Flame Chat</h1>

<div *ngIf="sendPrivateMessageOn" class="text-center searchContainer">
  <div class="mb-2 w-50">
    <input
      [(ngModel)]="searchWord"
      type="text"
      class="form-control"
      id="floatingInput"
      name="search"
      placeholder="Üzenet keresése"
    />
  </div>
</div>

<div class="row" *ngIf="!sendPrivateMessageOn">
  <div *ngFor="let user of userProfiles" class="col-12 col-md-6 col-lg-3 mb-2">
    <ngb-toast
      [id]="user.uid"
      class="d-grid justify-content-center text-center"
      [autohide]="false"
      [header]="user.displayName"
    >
      <img [src]="user.profilePicture" width="50px" height="50px" alt="" />
      <div>
        <small>{{ user.email }}</small>
      </div>

        <ng-container>
        
            <button
              [ngClass]="user.uid == signedFriend.uid ? 'green' : ''"
              (click)="signAsFirstFriend(user)"
              mat-raised-button
              color="accent"
              type="button"
            >
              <span class="icons"
                ><mat-icon>
                  {{ user.uid === signedFriend.uid ? "done" : "person_add" }}
                </mat-icon></span
              >
            </button>
        
        
        <button 
          (click)="getMessageUser(user)"
          class="btn btn-sm btn-primary ms-2"
          type="button"
        >
          <span class="icons"
            ><mat-icon>
              {{ user.uid === signedFriend.uid ? "chat" : "chat" }}
            </mat-icon></span
          >
        </button>
            </ng-container>

      <h4 class="fw-bold text-success" *ngIf="user.uid === signedFriend.uid">
        Ismerosnek jelolve
      </h4>
    </ngb-toast>
  </div>
</div>

<div *ngFor="let fm of friendMessages">{{ fm.message }}</div>

<ng-container *ngIf="friendsOn">
  <h3 class="text-center">Ismerosok</h3>
  <div class="row" *ngFor="let friend of userProfile[0].friends">
    <div class="col">Felhasznalo {{ friend[0].displayName }}</div>
    <div class="col">Email {{ friend[0].email }}</div>
    <div class="col">Azonosito {{ friend[0].uid }}</div>
  </div>
</ng-container>

<div class="messageCardDiv d-grid justify-content-center">
  <mat-card class="messageCard mb-5">
    <mat-card-header class="justify-content-center">
      <mat-card-title>
        <mat-form-field class="messageInput">
          <mat-label>Üzenet írása</mat-label>
          <textarea [(ngModel)]="message.message" matInput rows="2"></textarea>
        </mat-form-field>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content class="text-center">
      <button
        class="me-2 mt-2"
        color="accent"
        (click)="!editMessage ? addMessage() : updateMessage()"
        mat-raised-button
      >
        {{ !editMessage ? "Üzenet küldése" : "Uzenet Modositasa" }}
      </button>
      <button
        class="mt-2 deleteButton"
        (click)="isSAdmin ? deleteMessages() : clearInput()"
        mat-raised-button
      >
        {{ isSAdmin ? "Üzenetek törlése" : "Mezö törlése" }}
      </button>
      <button (click)="backToUsers()" class="green mt-2 ms-2" type="button" mat-raised-button>
        <span class="icons">
          <mat-icon>
            keyboard_backspace
          </mat-icon>
        </span>
      </button>
    </mat-card-content>
  </mat-card>
</div>

<div
  [ngClass]="
    message.uid === user['userId']
      ? 'justify-content-start mainDivUser'
      : 'justify-content-end mainDivUsers'
  "
  class="d-grid mainDiv"
  *ngFor="
    let message of friendMessages | sort : message.date | filter : searchWord
  "
>
  <mat-card
    [ngClass]="_user.uid === user['userId'] ? 'left messagesCard' : 'right'"
    *ngFor="let _user of userProfiles"
    class="card"
  >
    <ng-container *ngIf="message.uid === _user['uid']">
      <mat-card-header>
        <mat-card-title-group>
          <mat-card-title>
            <!-- <div class="d-flex justify-content-start align-items-center"> -->
            {{ message.displayName }}

            <!-- </div> -->

            <!-- <div class="d-flex justify-content-end align-items-center"> -->
            <!-- <button
              [id]="message['key']"
              class="updateButton ms-2 mt-2"
              *ngIf="user.userId === message.uid"
              (click)="navigateToUpdateMessage(message)"
              type="button"
              mat-button
              color="accent"
            >
              Módosítás
            </button> -->
          </mat-card-title>
          <img
            #spanAnchor
            [id]="this.message['key']"
            mat-card-sm-image
            class="ms-2 overflow-auto"
            style="border-radius: 10px"
            [src]="message['profilePicture']"
            alt="Profilkép"
          />
          <!-- </div>  -->
        </mat-card-title-group>
      </mat-card-header>

      <div class="recipe-making-container">
        <mat-card-content>
          <b>{{ message.message }}</b>
        </mat-card-content>
        <mat-card-content class="card-content">
          <mat-card-subtitle> </mat-card-subtitle>
        </mat-card-content>
      </div>

      <mat-card-footer>
        <mat-card-content class="pad">
          <hr />

          <mat-card-title-group class="mat-card-title-group">
            <div class="emailDateDiv d-grid justify-content-start">
              <mat-card-subtitle
                [ngClass]="_user.uid === user['userId'] ? 'grey' : 'right'"
                >{{ message.email }}</mat-card-subtitle
              >
              <mat-card-subtitle
                [ngClass]="_user.uid === user['userId'] ? 'grey' : 'right'"
                >{{ message.date }}</mat-card-subtitle
              >
            </div>
          </mat-card-title-group>

          <div class="buttonCont">
            <mat-card-actions class="d-flex flex-wrap justify-content-end">
              <button
                class="me-2"
                [id]="message['key']"
                class="updateButton me-2"
                *ngIf="user.userId === message.uid"
                (click)="navigateToUpdateMessage(message)"
                mat-raised-button
                color="accent"
                type="button"
              >
                Módosítás
              </button>

              <span
                class="ms-2 mt-2 bi bi-trash3-fill h3 text-danger rounded"
                *ngIf="user.userId === message.uid"
                (click)="deleteMessage(message)"
              ></span>
            </mat-card-actions>
          </div>
        </mat-card-content>
      </mat-card-footer>
      <!-- <mat-card-actions class="justify-content-end">
                <button class="me-2"  routerLink="/recipes/edit" [queryParams]="{key: recipe.key}" mat-raised-button color="accent" type="button">Modositas</button>
                <button class="deleteButton"  (click)="deleteRecipe()" mat-raised-button type="button">Torles</button>
            </mat-card-actions>  -->
    </ng-container>
  </mat-card>
</div>
