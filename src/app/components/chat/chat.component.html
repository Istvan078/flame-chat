<!-- <app-toast
  *ngIf="notConfirmedSignedAsFriend"
  aria-live="polite"
  aria-atomic="true"
></app-toast> -->
<app-toast
  [isPostSharing]="true"
  aria-live="polite"
  aria-atomic="true"
></app-toast>
<ng-container>
  <div class="d-flex justify-content-center">
    <input
      [(ngModel)]="userSearched"
      (keyup)="searchUser()"
      placeholder="Felhasználó keresése"
      type="text"
      class="form-control w-50"
    />
  </div>
  <div
    *ngFor="let user of userSearchedProfiles"
    class="d-flex justify-content-center my-2"
  >
    <div
      (click)="toFriendProfile(user.uid)"
      class="d-flex justify-content-center align-items-center user-searched-container rounded"
    >
      <p class="text-center mb-0 me-2 fw-bold">
        {{ user.displayName }}
      </p>
      <div>
        <img
          class="rounded"
          width="50px"
          height="50px"
          [src]="user.profilePicture"
          alt="profilkép"
        />
      </div>
    </div>
    <ng-container *ngFor="let notFriend of userNotFriends">
      <div class="ms-2 d-flex justify-content-center align-items-center">
        <button
          *ngIf="notFriend.friendId === user.uid"
          (click)="signAsAFriend(notFriend)"
          mat-raised-button
          color="accent"
          type="button"
        >
          Ismerősnek jelölés
          <mat-icon class="align-middle"> person_add </mat-icon>
        </button>
      </div>
    </ng-container>
  </div>
</ng-container>
<div class="row justify-content-center align-items-center">
  <div class="col-xs-2 col-sm-6 notif-container">
    <mat-sidenav-container class="config-options-container">
      <mat-sidenav> </mat-sidenav>
      <mat-sidenav-content>
        <ol>
          <li>
            <mat-slide-toggle
              color="primary"
              (change)="updateUserNotifications($event)"
              #slideToggle
              [(ngModel)]="subscribedForNotifications"
            ></mat-slide-toggle>
            <mat-icon class="align-middle">notifications</mat-icon>
            <span class="align-middle">Értesítések</span>
          </li>
        </ol>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </div>
  <div class="col-xs-8 col-sm-6 title-container">
    <h2 class="text-center">
      <mat-icon class="align-middle text-warning"
        >local_fire_department</mat-icon
      >
      Flame Chat
      <mat-icon class="align-middle text-warning d-inline-block me-3 my-2"
        >local_fire_department</mat-icon
      >
      <span class="dot-menu align-middle" [mat-menu-trigger-for]="menu"
        >...</span
      >
    </h2>
    <mat-menu #menu="matMenu">
      <button [mat-menu-trigger-for]="visibilityMenu" mat-menu-item>
        <mat-icon>visibility</mat-icon>
        <span>Elérhető állapot</span>
      </button>
    </mat-menu>

    <mat-menu #visibilityMenu="matMenu">
      <button
        (click)="setVisibilityOn()"
        [ngClass]="userProfile.visibility ? 'bg-success' : ''"
        mat-menu-item
      >
        <mat-icon>visibility</mat-icon>
        <div>
          <span class="d-inline-block me-2">Bekapcsolva</span>
          @if(userProfile.visibility) {<mat-icon class="align-middle"
            >check</mat-icon
          >
          }
        </div>
      </button>
      <button
        (click)="setVisibilityOff()"
        [ngClass]="!userProfile.visibility ? 'bg-danger' : ''"
        mat-menu-item
      >
        <mat-icon>visibility_off</mat-icon>
        <div>
          <span class="d-inline-block me-2">Kikapcsolva</span>
          @if(!userProfile.visibility){<mat-icon class="align-middle"
            >check</mat-icon
          >}
        </div>
      </button>
    </mat-menu>
  </div>
</div>

<div class="row">
  <div class="col">
    <mat-accordion class="modern-accordion">
      <mat-expansion-panel
        [disabled]="!userFriends?.length && !userProfile.uid"
        class="modern-panel mb-2"
      >
        <mat-expansion-panel-header
          [@slide-in-out]
          (click)="getMyPosts()"
          class="modern-panel-header my-posts-header"
        >
          @if(userProfile?.displayName) {
          <mat-panel-title class="modern-panel-title">
            <div class="user-info">
              <span class="user-name align-middle d-inline-flex me-2">{{ userProfile.displayName }}</span>
              <img
                width="25px"
                height="25px"
                class="rounded-circle user-avatar"
                [src]="userProfile.profilePicture"
                alt="Profilkép"
              />
              <span
                [matBadgeDisabled]="!myPostsNotificationNumber"
                [matBadge]="myPostsNotificationNumber"
                matBadgeColor="primary"
                matBadgeSize="small"
                aria-hidden="false"
                class="notification-icon align-middle"
              >
            </span>
            </div>
          </mat-panel-title>
          }
        </mat-expansion-panel-header>
        <ng-template matExpansionPanelContent>
          <div class="panel-content">
            <app-my-posts></app-my-posts>
          </div>
        </ng-template>
      </mat-expansion-panel>

      <mat-expansion-panel
        [disabled]="!userFriends?.length && !userProfile.uid"
        class="modern-panel mb-2"
      >
        <mat-expansion-panel-header
          [@slide-in-keyframed]
          (click)="getSharedPosts()"
          class="modern-panel-header exp-panel-headers"
        >
          <mat-panel-title class="modern-panel-title">
            <div class="panel-title-content">
              <span class="me-2 align-middle">Kezdőlap</span>
              <mat-icon
                matBadgeSize="small"
                [matBadgeDisabled]="!postsNotificationNumber"
                matBadge="{{ postsNotificationNumber }}"
                matBadgeColor="primary"
                aria-hidden="false"
                class="feeds-icon notification-icon"
                >feed</mat-icon
              >
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <ng-template matExpansionPanelContent>
          <div class="panel-content">
            <app-news [userFriends]="this.userFriends"></app-news>
          </div>
        </ng-template>
      </mat-expansion-panel>

      <mat-expansion-panel
        [disabled]="!userFriends?.length && !userProfile.uid"
        class="modern-panel mb-2"
      >
        <mat-expansion-panel-header
          [@slide-in-keyframed]
          routerLink="/message"
          class="modern-panel-header"
          [ngClass]="newMessageNumber > 0 ? 'newMessage' : 'exp-panel-headers'"
        >
          <mat-panel-title class="modern-panel-title">
            <div class="panel-title-content">
              <span class="me-2 align-middle">Üzenetek</span>
              <mat-icon
                matBadgeSize="small"
                [matBadgeDisabled]="!newMessageNumber"
                matBadge="{{ newMessageNumber }}"
                matBadgeColor="primary"
                class="messages-icon notification-icon"
                aria-hidden="false"
                >chat</mat-icon
              >
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>
      </mat-expansion-panel>

      <mat-expansion-panel [disabled]="!userProfile.uid" class="modern-panel mb-2">
        <mat-expansion-panel-header
          [@slide-in-keyframed]
          (click)="toAlbum()"
          class="modern-panel-header exp-panel-headers"
        >
          <mat-panel-title class="modern-panel-title">
            <div class="panel-title-content">
              <span class="me-2 align-middle">Fényképeim</span>
              <mat-icon class="album-icon align-middle">photos</mat-icon>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>
      </mat-expansion-panel>

      <mat-expansion-panel [disabled]="!userProfile.uid" class="modern-panel mb-2">
        <mat-expansion-panel-header
          [@slide-in-keyframed]
          class="modern-panel-header exp-panel-headers"
        >
          <mat-panel-title class="modern-panel-title">
            <div class="panel-title-content">
              <span class="me-2 align-middle">Ismerősök</span>
              <mat-icon
                matBadgeSize="small"
                [matBadgeDisabled]="!userFriends?.length"
                [matBadge]="userFriends?.length"
                matBadgeColor="primary"
                class="friends-icon notification-icon"
                aria-hidden="false"
                >groups</mat-icon
              >
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="row justify-content-center">
          @for(friend of userFriends; let i = $index; track friend.displayName)
          {
            <ng-container>
          <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                <mat-card
                  class="mb-2 mt-3 d-grid justify-content-center matCardBg"
                >
                  <mat-card-header class="d-grid justify-content-center">
                    <mat-card-title>
                      {{ friend.displayName }}
                    </mat-card-title>
                  </mat-card-header>
                  <mat-card-content class="d-flex justify-content-center"
                    ><img
                      [src]="friend.profilePicture"
                      alt=""
                      width="50px"
                      height="50px"
                      class="rounded"
                      (click)="showProfPics(friend)"
                  /></mat-card-content>
                  <mat-card-footer>
                    <mat-card-content
                      class="d-flex flex-column justify-content-center flex-wrap"
                    >
                      <mat-card-subtitle class="text-center friend-email">
                        {{ friend.email }}
                      </mat-card-subtitle>
                      <div class="text-center">
                        <button
                          style="width: max-content"
                          matIconSuffix
                          (click)="toFriendProfile(friend.friendId)"
                          class="btn btn-sm btn-primary me-2 mb-1"
                          type="button"
                        >
                          <span class="text-center align-middle"
                            >Profil megtekintése
                          </span>

                          <mat-icon class="text-center align-middle"
                            >person</mat-icon
                          >
                        </button>
                        <button
                          matIconSuffix
                          (click)="removeFriend(friend)"
                          class="btn btn-sm btn-danger"
                          type="button"
                        >
                          <span class="align-middle">Törlés</span>

                          <mat-icon class="align-middle"
                            >person_remove</mat-icon
                          >
                        </button>
                      </div>
                    </mat-card-content>
                  </mat-card-footer>
                </mat-card>
              </div>
            </ng-container>
          }
        </div>
      </mat-expansion-panel>

      <mat-expansion-panel [disabled]="!userProfile.uid" class="modern-panel mt-2">
        <mat-expansion-panel-header
          [@slide-in-keyframed]
          (click)="toUserProfile()"
          class="modern-panel-header exp-panel-headers"
        >
          <mat-panel-title class="modern-panel-title">
            <div class="panel-title-content">
              <span class="me-2 align-middle">Profilom</span>
              <mat-icon class="profile-icon align-middle">person</mat-icon>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="panel-content">
          <app-user-profile
            *ngIf="isUserProfileOn && userProfile.uid"
          ></app-user-profile>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>

<div class="row justify-content-center" *ngIf="friendsOn">
  <div
    *ngIf="notConfirmedMeUsers.length"
    class="col-12 col-md-6 col-lg-3 mb-2 mt-2 d-flex justify-content-center"
  >
    <app-toast
      (confirmedFriend)="confirmedFriend($event)"
      [notConfirmedSignedMe]="true"
    >
    </app-toast>
  </div>
  @for(notFriend of userNotFriends; let i = $index; track notFriend.email){
  <div class="col-12 col-md-6 col-lg-3 mb-2 d-flex justify-content-center">
    <div class="friend-card">
      <div class="friend-card-content">
        <div class="friend-header">
          <div class="friend-avatar">
            <img
              [src]="notFriend?.profilePicture"
              alt="Profilkép"
              class="avatar-image"
              (click)="showProfPics(notFriend)"
            />
          </div>
          <div class="friend-info">
            <h3 class="friend-name">{{ notFriend?.displayName }}</h3>
            <p class="friend-email">{{ notFriend.email }}</p>
          </div>
        </div>
        <div class="friend-actions">
          <button
            (click)="signAsAFriend(notFriend)"
            class="add-friend-button"
            mat-raised-button
          >
            <mat-icon>person_add</mat-icon>
            <span>Ismerősnek jelölés</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  }
</div>
